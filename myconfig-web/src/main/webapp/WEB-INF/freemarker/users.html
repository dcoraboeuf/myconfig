<#include "/lib/layout.html">

<#macro item_column_boolean field item class="">
	<td class="item-column item-column-${field} ${class}">
		<#if item[field]>
			<@lh key="general.yes" />
		<#else>
			<@lh key="general.no" />
		</#if>
	</td>
</#macro>

<@layout_std pageId="users" script=true style=true modules=["items"]>
	<@panel>
		<table class="items">
			<thead>
				<tr>
					<th>
						<@lh key="model.user" />
					</th>
					<th>
						<@lh key="model.user.admin" />
					</th>
					<th>
						<@lh key="model.user.verified" />
					</th>
					<#list userFunctions as userFunction>
						<th class="user-function">
							<p class="function user-function">${userFunction}</p>
							<p class="info user-function"><@lh key = "UserFunction." + userFunction /></p>
						</th>
					</#list>
					<th>
						-
					</th>
				</tr>
			</thead>
			<tbody>
				<#list users as user>
					<tr class="<@item_row_class index=user_index />"">
						<td class="item-column item-column-name">
							${user.name?html}
						</td>
						<@item_column_boolean item=user field="admin" />
						<@item_column_boolean item=user field="verified" />
						<#list userFunctions as userFunction>
							<td class="item-column user-function">
								<#if user.admin>
									<img src="static/images/user_admin.png" title="<@lh key='users.userfunction.admin' />" />
								<#else>
									<#if user.functions?seq_contains(userFunction)>
										<#assign hasfn = "yes" />
									<#else>
										<#assign hasfn = "no" />
									</#if>
									<div
										user="${user.name?html}"
										function="${userFunction}"
										set="${hasfn}"
										class="user-function"
										onclick="Users.assignUserFunction(this);" />
								</#if>
							</td>
						</#list>
						<td class="item-actions">
							<#if !user.admin>
								<@item_delete item=user action="gui/user/delete" formField="name" promptKey="users.delete" />
							</#if>
						</td>
					</tr>
				</#list>
			</tbody>
		</table>
		<@panel title="users.create">
			<@form>
				<form action="gui/user/create" method="POST" onsubmit="return Users.validateCreate();">
					<table>
						<tbody>
							<tr>
								<td class="form-label">
									<label for="user-name">
										<@lh key="model.user.name" />
									</label>
								</td>
								<td class="form-input" colspan="2">
									<input id="user-name" autofocus="autofocus" type="text" name="name" maxlength="80" size="20" />
								</td>
							</tr>
							<tr>
								<td class="form-label">
									<label for="user-email">
										<@lh key="model.user.email" />
									</label>
								</td>
								<td class="form-input">
									<input id="user-email" name="email" type="email" maxlength="120" size="40" />
								</td>
								<td>
									<input type="submit" value="<@lh key='users.create.submit' />" />
								</td>
							</tr>
							<#if .data_model["error"]??>
								<tr>
									<td colspan="3" class="error">
										${.data_model["error"]}
									</td>
								</tr>
							</#if>
						</tbody>
					</table>
				</form>
			</@form>
		</@panel>
	</@panel>
</@layout_std>