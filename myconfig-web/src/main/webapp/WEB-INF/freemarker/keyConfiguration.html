<#include "/lib/layout.html">

<#macro configuration_key class="" value="">
	<#if value != "">
		<a href="gui/configuration/key/${keyConfiguration.id}/${value?html}" class="key ${class}">${value?html}</a>
	</#if>
</#macro>

<#macro configuration_value key environment version value="">
	<@configuration_input_value
		application=keyConfiguration.id
		value=value
		key=key
		environment=environment
		version=version />
</#macro>

<@layout_std pageId="keyConfiguration" style=true script=false modules=["configuration"] title=loc('keyConfiguration', keyConfiguration.key.name)>
	<input id="application" type="hidden" value="${keyConfiguration.id}" />
	<article class="configuration">
		<table>
			<thead>
				<tr class="navigation">
					<th colspan="${ keyConfiguration.environmentValuesPerVersionList?size + 1 }">
						<@configuration_key value=keyConfiguration.previousKey class="previous" />
						<span class="key current">${keyConfiguration.key.name?html}</span>
						<@configuration_key value=keyConfiguration.nextKey class="next" />
					</th>
				</tr>
				<tr class="columns">
					<th class="version-title"><@lh key="model.version.name" /></th>
					<#list keyConfiguration.environmentValuesPerVersionList as environmentConfiguration>
						<th class="column-title">
							<a href="gui/configuration/environment/${keyConfiguration.id}/${environmentConfiguration.name?html}">${environmentConfiguration.name?html}</a>
						</th>
					</#list>
				</tr>
			</thead>
			<tbody>
				<#list keyConfiguration.versionList as version>
					<tr>
						<td class="version"><a href="gui/configuration/version/${keyConfiguration.id}/${version.name?html}">${version.name?html}</a></td>
						<#list keyConfiguration.environmentValuesPerVersionList as environmentConfiguration>
							<td class="environment-value">
								<@configuration_value value=environmentConfiguration.values[version.name] key=keyConfiguration.key environment=environmentConfiguration.name version=version.name />
							</td>
						</#list>
					</tr>
				</#list>
			</tbody>
			<tfoot>
				<tr>
					<td colspan="${ keyConfiguration.environmentValuesPerVersionList?size + 1 }" class="configuration-commands">
						<div id="configuration-changes-submit" class="configuration-command configuration-command-submit configuration-command-disabled" onclick="configuration.controlConfigurationChanges()"><@lh key="configuration.changes.submit" /></div>
						<div id="configuration-changes-reset" class="configuration-command configuration-command-cancel configuration-command-disabled" onclick="configuration.resetConfigurationChanges()"><@lh key="configuration.changes.reset" /></div>
					</td>
				</tr>
			</tfoot>
		</table>
	</article>
	<@layout_std_nav href="gui/" key="applications" />
	<@layout_std_nav href="gui/application/${keyConfiguration.id}" key="application" />
	<@layout_std_nav href="gui/matrix/${keyConfiguration.id}" key="matrix" />
	
	<@configuration_dialog />
	
</@layout_std>