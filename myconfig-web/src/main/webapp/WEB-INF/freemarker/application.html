<#include "/lib/layout.html">
<@layout_std pageId="application" script=true modules=["items","key"] title=loc("application.title", application.name)>
	<article class="application">
		<@panel title="application.versions">
			<@items_crud
				id="versions"
				columns=[{
					"header": "model.version.name",
					"field": "name"
					}, {
					"header": "application.version.keyCount",
					"field": "keyCount",
					"class": "item-column-type-number"
					}, {
					"header": "application.version.missingCount",
					"special": "missing_count",
					"action": "gui/configuration/version/${application.id}",
					"actionItemField": "name"
					}]
				list=application.versionSummaryList
				deleteAction="gui/application/${application.id}/version/delete"
				deleteField="name"
				deletePromptKey="version.delete"
				editAction="gui/configuration/version/${application.id}"
				editField="name"
				createId="version-create"
				createAction="gui/application/${application.id}/version/create"
				errorKey="version_error"
				/>
		</@panel>
		<@panel title="application.environments">
			<@items_crud
				id="environments"
				columns=[{
					"header": "model.environment.name",
					"field": "name"
					}, {
					"header": "application.environment.missingCount",
					"special": "missing_count",
					"action": "gui/configuration/environment/${application.id}",
					"actionItemField": "name"
					}]
				list=application.environmentSummaryList
				deleteAction="gui/application/${application.id}/environment/delete"
				deleteField="name"
				deletePromptKey="environment.delete"
				editAction="gui/configuration/environment/${application.id}"
				editField="name"
				createId="environment-create"
				createAction="gui/application/${application.id}/environment/create"
				errorKey="environment_error"
				/>
		</@panel>
		<@panel title="application.keys">
			<@items_crud
				id="keys"
				columns=[{
					"header": "model.key.name",
					"field": "name"
					}, {
					"header": "model.key.description",
					"special": "key_description"
					}, {
					"header": "application.key.versionCount",
					"field": "versionCount",
					"class": "item-column-type-number"
					}, {
					"header": "application.key.missingCount",
					"special": "missing_count",
					"action": "gui/configuration/key/${application.id}",
					"actionItemField": "name"
					}]
				list=application.keySummaryList
				deleteAction="gui/application/${application.id}/key/delete"
				deleteField="name"
				deletePromptKey="key.delete"
				editAction="gui/configuration/key/${application.id}"
				editField="name"
				errorKey="key_error">
				<@key_create formClass="crud" action="gui/application/${application.id}/key/create" />
			</@items_crud>
			<div id="dialog-key-update" style="display:none;">
				<form action="gui/application/${application.id}/key/update" method="POST">
					<input id="dialog-key-name-value" name="name" type="hidden" value="" />
					<table>
						<tr>
							<td>
								<@lh key="model.key.name" />
							</td>
							<td id="dialog-key-name"></td>
						</tr>
						<tr>
							<td>
								<label for="dialog-key-description">
									<@lh key="model.key.description" />
								</label>
							</td>
							<td>
								<textarea id="dialog-key-description" name="description" rows="2" cols="20"></textarea>
							</td>
						</tr>
						<tr>
							<td colspan="2" align="right">
								<input id="dialog-key-submit" type="submit" value="<@lh key='general.update' />" />
							</td>
						</tr>
					</table>
				</form>
			</div>
		</@panel>
	</article>
	<@layout_std_nav href="gui/" key="applications" />
	<@layout_std_nav href="gui/matrix/${application.id}" key="matrix" />
</@layout_std>

<#macro key_description item>
	<td id="key_${item.name?html}" description="${item.description?html}" class="item-column item-column-description">
		${item.description?html}
		<img class="action" src="static/images/edit.png" onclick="Application.editKeyDescription('${item.name?html}');" />
	</td>
</#macro>