<#include "/lib/layout.html">

<#macro configuration_environment class="" value="">
	<#if value != "">
		<a href="gui/configuration/environment/${versionConfiguration.id}/${value?html}" class="environment ${class}">${value?html}</a>
	</#if>
</#macro>

<#macro configuration_value value key environment version>
	<#if value.enabled>
		<#assign textValue = value.value />
		<input
			class="value"
			id="value_${key.name?html}_${environment?html}_${version?html}"
			name="value_${key.name?html}_${environment?html}_${version?html}"
			oldvalue="${textValue?html}"
			value="${textValue?html}"
			maxlength="500"
			size="30"
			application="${environmentConfiguration.id}"
			key="${key.name?html}"
			environment="${environment?html}"
			version="${version?html}"
			onchange="versionConfiguration.updateConfigurationValue(this)"
			/>
	<#else>
		<a href="gui/matrix/${environmentConfiguration.id}" title="${loc('environmentConfiguration.na.tip',key,version)?html}"><@lh key="environmentConfiguration.na" /></a>
	</#if>
</#macro>

<@layout_std pageId="environmentConfiguration" style=true script=true modules=[] title=loc('environmentConfiguration', environmentConfiguration.environment)>
	<input id="application" type="hidden" value="${environmentConfiguration.id}" />
	<input id="environment" type="hidden" value="${environmentConfiguration.environment?html}" />
	<article class="configuration">
		<table>
			<thead>
				<tr class="navigation">
					<th colspan="${ environmentConfiguration.versionValuesPerKeyList?size + 1 }">
						<@configuration_environment value=environmentConfiguration.previousVersion class="previous" />
						<span class="environment current">${environmentConfiguration.environment?html}</span>
						<@configuration_environment value=environmentConfiguration.nextVersion class="next" />
					</th>
				</tr>
				<tr class="columns">
					<th class="key-title"><@lh key="model.key.name" /></th>
					<#list environmentConfiguration.versionValuesPerKeyList as versionConfiguration>
						<th class="column-title">
							<a href="gui/configuration/version/${environmentConfiguration.id}/${versionConfiguration.name?html}">${versionConfiguration.name?html}</a>
						</th>
					</#list>
				</tr>
			</thead>
			<tbody>
				<#list environmentConfiguration.keyList as key>
					<tr>
						<td class="key">
							<div class="key-name">${key.name?html}</div>
							<div class="key-description"><@ellipsis value=key.description maxlength=30 /></div>
						</td>
						<#list environmentConfiguration.versionValuesPerKeyList as versionConfiguration>
							<td class="key-value">
								<@configuration_value value=versionConfiguration.values[key.name] key=key environment=environmentConfiguration.environment version=versionConfiguration.name />
							</td>
						</#list>
					</tr>
				</#list>
			</tbody>
			<tfoot>
				<tr>
					<td colspan="${ environmentConfiguration.versionValuesPerKeyList?size + 1 }" class="configuration-commands">
						<div id="configuration-changes-submit" class="configuration-command configuration-command-submit configuration-command-disabled" onclick="environmentConfiguration.controlConfigurationChanges()"><@lh key="configuration.changes.submit" /></div>
						<div id="configuration-changes-reset" class="configuration-command configuration-command-cancel configuration-command-disabled" onclick="environmentConfiguration.resetConfigurationChanges()"><@lh key="configuration.changes.reset" /></div>
					</td>
				</tr>
			</tfoot>
		</table>
	</article>
	<@layout_std_nav href="gui/" key="applications" />
	<@layout_std_nav href="gui/application/${environmentConfiguration.id}" key="application" />
	<@layout_std_nav href="gui/matrix/${environmentConfiguration.id}" key="matrix" />
	<div id="dialog-changes" style="display:none;">
		<table class="configuration-changes">
			<thead>
				<tr>
					<th><@lh key="configuration.change.version" /></th>
					<th><@lh key="configuration.change.key" /></th>
					<th><@lh key="configuration.change.oldvalue" /></th>
					<th><@lh key="configuration.change.value" /></th>
				</tr>
			</thead>
			<tbody id="configuration-changes">
			</tbody>
			<tfoot>
				<tr>
					<td colspan="4" class="configuration-commands">
						<div class="configuration-command configuration-command-submit" onclick="environmentConfiguration.submitConfigurationChanges()"><@lh key="configuration.changes.submit" /></div>
						<div class="configuration-command configuration-command-cancel" onclick="$('#dialog-changes').dialog('close')"><@lh key="general.cancel" /></div>
					</td>
				</tr>
			</tfoot>
		</table>
	</div>
</@layout_std>