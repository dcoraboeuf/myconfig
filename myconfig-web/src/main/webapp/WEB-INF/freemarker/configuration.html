<#include "/lib/layout.html">

<#macro configuration_version class="" value="">
	<#if value != "">
		<a href="gui/configuration/${configuration.id}/${value}" class="version ${class}">${value?html}</a>
	</#if>
</#macro>

<#macro configuration_value value key environment version>
	<input
		class="value"
		id="value_${key.name?html}_${environment?html}_${version?html}"
		name="value_${key.name?html}_${environment?html}_${version?html}"
		oldvalue="${value?html}"
		value="${value?html}"
		maxlength="500"
		size="30"
		application="${configuration.id}"
		key="${key.name?html}"
		environment="${environment?html}"
		version="${version?html}"
		onchange="myconfig.updateConfigurationValue(this)"
		/>
</#macro>

<@layout_std pageId="configuration" style=true modules=[]>
	<article class="configuration">
		<table>
			<thead>
				<tr class="version">
					<th>
						<@configuration_version value=configuration.previousVersion class="previous" />
						<span class="version current">${configuration.version?html}</span>
						<@configuration_version value=configuration.nextVersion class="next" />
					</th>
				</tr>
				<tr>
					<th class="key-title"><@lh key="model.key.name" /></th>
					<#list configuration.environmentConfigurationList as environmentConfiguration>
						<th class="environment">
							${environmentConfiguration.name?html}
						</th>
					</#list>
				</tr>
			</thead>
			<tbody>
				<#list configuration.keyList as key>
					<tr>
						<td class="key">
							${key.name?html}
						</td>
						<#list configuration.environmentConfigurationList as environmentConfiguration>
							<td class="key-value">
								<#if environmentConfiguration.values[key.name]??>
									<#assign value = environmentConfiguration.values[key.name] />
								<#else>
									<#assign value = "" />
								</#if>
								<@configuration_value value=value key=key environment=environmentConfiguration.name version=configuration.version />
							</td>
						</#list>
					</tr>
				</#list>
			</tbody>
		</table>
	</article>
	<@layout_std_nav href="gui/" key="applications" />
	<@layout_std_nav href="gui/application/${configuration.id}" key="configuration" />
	<@layout_std_nav href="gui/matrix/${configuration.id}" key="matrix" />
</@layout_std>