<#-- Resources -->
<link rel="stylesheet/less" type="text/css" href="modules/crud/less/crud.less" />
<script src="modules/crud/scripts/crud.js" type="text/javascript"></script>

<#macro crud_table items id="crud" >
	<#assign columns = [] >
	<#nested>
	<table id="crud-table-${id}" class="crud">
		<thead>
			<tr>
				<#list columns as column>
					<th>
						<@lh key=column.key />
					</th>
				</#list>
				<th>
				</th>
			</tr>
		</thead>
		<tbody>
			<#list items as item>
				<tr>
					<#list columns as column>
						<td class="crud-column-${column.property} ${column.class}">
							${item[column.property]?html}
						</td>
					</#list>
					<td>
						<#if deletion??>
							<#assign deletionField = item[deletion.field] />
							<#assign deletionFieldName = item[deletion.promptField] />
							<form class="crud-action crud-delete" action="${deletion.action}" method="post" onsubmit="return CRUD.confirmDelete('${deletionField}');">
								<input type="hidden" id="crud-delete-prompt-${deletionField}" value="${loc(deletion.promptKey, deletionFieldName)?html}" />
								<input type="hidden" name="${deletion.field}" value="${ deletionField }" />
								<input class="crud-action crud-delete" type="image" src="modules/crud/images/delete.png" />
							</form>
						</#if>
						<#if edition??>
							<#assign editionField = item[edition.field] />
							<form class="crud-action crud-edit" action="${edition.action} " method="get">
								<input type="hidden" name="${edition.field}" value="${ editionField }" />
								<input class="crud-action crud-edit" type="image" src="modules/crud/images/edit.png" />
							</form>
						</#if>
					</td>
				</tr>
			</#list>
		</tbody>
		<tfoot>
			<tr>
				<td colspan="${ columns?size + 1 }">
					<#if creation??>
						<form class="crud-create" action="${creation.action}" method="post" onsubmit="return CRUD.validateCreate('${creation.id}')">
							<label>
								<@lh key=creation.label />
								<input id="crud-create-text-${creation.id}" name="${creation.field}" type="text" maxlength="${creation.maxlength}" size="${creation.size}" autofocus="autofocus" />
								<input id="crud-create-submit-${creation.id}" type="submit" value="<@lh key=creation.submit />" />
							</label>
						</form>
					</#if>
				</td>
			</tr>
		</tfoot>
	</table>
</#macro>

<#macro crud_column property key class="">
	<#assign columns = columns + [{
		"property": property,
		"key": key,
		"class": class
	}] >
</#macro>

<#macro crud_create action label="general.create.label" field="name" id="" maxlength="80" size="20" submit="general.create">
	<#assign creation = {"action": action,
		"label": label,
		"field": field,
		"id": id,
		"maxlength": maxlength,
		"size": size,
		"submit": submit
	} />
</#macro>

<#macro crud_delete action field="id" promptKey="general.delete" promptField="name">
	<#assign deletion = {
		"action": action,
		"field": field,
		"promptKey": promptKey,
		"promptField": promptField
	} />
</#macro>

<#macro crud_edit action field="id">
	<#assign edition = {
		"action": action,
		"field": field
	} />
</#macro>